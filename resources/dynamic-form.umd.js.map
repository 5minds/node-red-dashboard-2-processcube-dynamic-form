{"version":3,"file":"dynamic-form.umd.js","sources":["../ui/components/DynamicForm.vue"],"sourcesContent":["<template>\n  <!-- Component must be wrapped in a block so props such as className and style can be passed in from parent -->\n  <div className=\"dynamic-form-wrapper\">\n    <p v-if=\"hasFields()\">\n      <v-form ref=\"form\" v-model=\"form\">\n        <v-row v-for=\"(field, index) in fields()\" :key=\"index\">\n          <v-col cols=\"12\">\n            <component\n              :is=\"field.component\"\n              :id=\"field.id\"\n              v-model=\"formData[field.id]\"\n              :required=\"field.required\"\n              :items=\"field.items\"\n              :label=\"field.label\" />\n          </v-col>\n        </v-row>\n\n        <v-row style=\"display: flex; gap: 8px; padding: 12px\">\n          <div\n            v-for=\"(action, index) in actions\"\n            :key=\"index\"\n            style=\"flex-grow: 1\">\n            <v-btn\n              :key=\"index\"\n              style=\"width: 100%\"\n              @click=\"actionFn(action.label)\">\n              {{ action.label }}\n            </v-btn>\n          </div>\n        </v-row>\n      </v-form>\n    </p>\n    <p v-else>\n      <v-alert :text=\"waiting_info\" :title=\"waiting_title\" />\n    </p>\n  </div>\n</template>\n\n<script>\nimport { markRaw } from \"vue\";\nimport { mapState } from \"vuex\";\n\nexport default {\n  name: \"DynamicForm\",\n  inject: [\"$socket\"],\n  props: {\n    /* do not remove entries from this - Dashboard's Layout Manager's will pass this data to your component */\n    id: { type: String, required: true },\n    props: { type: Object, default: () => ({}) },\n    state: {\n      type: Object,\n      default: () => ({ enabled: false, visible: false }),\n    },\n  },\n  setup(props) {\n    console.info(\"DynamicForm setup with:\", props);\n    console.debug(\"Vue function loaded correctly\", markRaw);\n  },\n  data() {\n    return {\n      actions: [],\n      form: {},\n      formData: {},\n    };\n  },\n  computed: {\n    ...mapState(\"data\", [\"messages\"]),\n    waiting_title() {\n      return this.props.waiting_title || \"Warten auf den Usertask...\"\n    },\n    waiting_info() {\n      return (\n        this.props.waiting_info ||\n        \"Der Usertask wird automatisch angezeigt, wenn ein entsprechender Task vorhanden ist.\"\n      );\n    },\n  },\n  mounted() {\n    this.$socket.on(\"widget-load:\" + this.id, (msg) => {\n      this.init()\n\n      this.$store.commit(\"data/bind\", {\n        widgetId: this.id,\n        msg,\n      });\n    });\n    this.$socket.on(\"msg-input:\" + this.id, (msg) => {\n      // store the latest message in our client-side vuex store when we receive a new message\n      this.init()\n\n      if (msg.payload && msg.payload.userTask && msg.payload.userTask.startToken && msg.payload.userTask.startToken.formData) {\n        //this.formData = { ...msg.payload.userTask.startToken.formData };\n        this.formData = { ...msg.payload.userTask.startToken }\n        console.info(this.formData)\n      }\n\n      this.$store.commit(\"data/bind\", {\n        widgetId: this.id,\n        msg,\n      });\n    });\n    // tell Node-RED that we're loading a new instance of this widget\n    this.$socket.emit(\"widget-load\", this.id);\n  },\n  unmounted() {\n    /* Make sure, any events you subscribe to on SocketIO are unsubscribed to here */\n    this.$socket?.off(\"widget-load\" + this.id);\n    this.$socket?.off(\"msg-input:\" + this.id);\n  },\n  methods: {\n    hasUserTask() {\n      return (\n        this.messages &&\n        this.messages[this.id] &&\n        this.messages[this.id].payload.userTask\n      );\n    },\n    userTask() {\n      return this.hasUserTask() ? this.messages[this.id].payload.userTask : {};\n    },\n    fields() {\n      const aFields = this.hasUserTask()\n        ? this.userTask().userTaskConfig.formFields\n        : [];\n\n      const fieldMap = aFields.map((field) => ({\n        ...field,\n        component: mapFieldTypes(field.type),\n        items: mapItems(field.type, field),\n      }));\n\n      return fieldMap;\n    },\n    hasFields() {\n      return (\n        this.messages &&\n        this.messages[this.id] &&\n        this.messages[this.id].payload.userTask !== undefined\n      );\n    },\n    /*\n            widget-action just sends a msg to Node-RED, it does not store the msg state server-side\n            alternatively, you can use widget-change, which will also store the msg in the Node's datastore\n        */\n    send(msg, index) {\n      const msgArr = [];\n      msgArr[index] = msg;\n      console.info(msgArr);\n      this.$socket.emit(\"widget-action\", this.id, msgArr);\n    },\n    init() {\n      this.actions = this.props.options;\n    },\n    actionFn(action) {\n      this.send(\n        { payload: { formData: this.formData, userTask: this.userTask() } },\n        this.actions.findIndex((element) => element.label === action)\n      );\n    },\n  },\n};\n\nfunction mapItems(type, field) {\n  if (type === \"enum\") {\n    return field.enumValues.map((enumValue) => ({\n      title: enumValue.name,\n      value: enumValue.id,\n    }));\n  } else {\n    return null;\n  }\n}\n\nfunction mapFieldTypes(fieldType) {\n  switch (fieldType) {\n    case \"string\":\n      return \"v-text-field\";\n    case \"long\":\n    case \"date\":\n      return \"v-text-field\";\n    case \"enum\":\n      return \"v-select\";\n    case \"boolean\":\n      return \"v-checkbox\";\n    case \"text\":\n      return \"v-text-field\";\n    case \"select\":\n      return \"v-select\";\n    case \"checkbox\":\n      return \"v-checkbox\";\n    case \"radio\":\n      return \"v-radio\";\n    case \"switch\":\n      return \"v-switch\";\n    case \"slider\":\n      return \"v-slider\";\n    case \"time\":\n      return \"v-time-picker\";\n    case \"datetime\":\n      return \"v-datetime-picker\";\n    case \"color\":\n      return \"v-color-picker\";\n    case \"file\":\n      return \"v-file-input\";\n    case \"textarea\":\n      return \"v-textarea\";\n    case \"password\":\n      return \"v-text-field\";\n    case \"number\":\n      return \"v-text-field\";\n    case \"email\":\n      return \"v-text-field\";\n    case \"tel\":\n      return \"v-text-field\";\n    case \"url\":\n      return \"v-text-field\";\n    default:\n      return \"v-text-field\";\n  }\n}\n</script>\n\n<style scoped>\n/* CSS is auto scoped, but using named classes is still recommended */\n@import \"../stylesheets/dynamic-form.css\";\n</style>\n"],"names":["_sfc_main","props","markRaw","mapState","msg","_a","_b","field","mapFieldTypes","mapItems","index","msgArr","action","element","type","enumValue","fieldType","_hoisted_1","_openBlock","_createElementBlock","_Fragment","_createCommentVNode","_createElementVNode","$options","_hoisted_2","_createVNode","_component_v_form","$data","_cache","$event","_withCtx","_renderList","_createBlock","_component_v_row","_component_v_col","_resolveDynamicComponent","_component_v_btn","_createTextVNode","_toDisplayString","_hoisted_3","_component_v_alert"],"mappings":"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"}